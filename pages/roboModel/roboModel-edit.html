<!DOCTYPE html>
<html>
	<head>
		<!-- Basic Page Info -->
		<meta charset="utf-8" />
		<title>Tieu Luan Lap Trinh Mang</title>

		<!-- Site favicon -->
		<link
			rel="apple-touch-icon"
			sizes="180x180"
			href="../../vendors/images/apple-touch-icon.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="../../vendors/images/favicon-32x32.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="16x16"
			href="../../vendors/images/favicon-16x16.png"
		/>

		<!-- Mobile Specific Metas -->
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=1"
		/>

		<!-- Google Font -->
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
			rel="stylesheet"
		/>
		<!-- CSS -->
		<link rel="stylesheet" type="text/css" href="../../vendors/styles/core.css" />
		<link rel="stylesheet" type="text/css" href="../../css/user.css" />
		<link
			rel="stylesheet"
			type="text/css"
			href="../../vendors/styles/icon-font.min.css"
		/>
		<link rel="stylesheet" type="text/css" href="../../vendors/styles/style.css" />
        <link rel="stylesheet" type="text/css" href="../../vendors/styles/dropzone.css" />

	</head>
	<body>
		<div class="pre-loader">
			<div class="pre-loader-box">
				<div class="loader-logo">
					<img src="../../vendors/images/deskapp-logo.svg" alt="" />
				</div>
				<div class="loader-progress" id="progress_div">
					<div class="bar" id="bar1"></div>
				</div>
				<div class="percent" id="percent1">0%</div>
				<div class="loading-text">Loading...</div>
			</div>
		</div>

		<div class="header">
			<div class="header-left">
				<div class="menu-icon bi bi-list"></div>
				<div
					class="search-toggle-icon bi bi-search"
					data-toggle="header_search"
				></div>
			</div>
			<div class="header-right">
				<div class="dashboard-setting user-notification">
					<div class="dropdown">
						<a
							class="dropdown-toggle no-arrow"
							href="javascript:;"
							data-toggle="right-sidebar"
						>
							<i class="dw dw-settings2"></i>
						</a>
					</div>
				</div>
				<div class="user-info-dropdown">
					<div class="dropdown">
						<a
							class="dropdown-toggle"
							href="#"
							role="button"
							data-toggle="dropdown"
						>
							<span class="user-icon">
								<img src="../../vendors/images/photo1.jpg" alt="" />
							</span>
							<span class="user-name">Ross C. Lopez</span>
						</a>
						<div
							class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list"
						>
							<a class="dropdown-item" href="profile.html"
								><i class="dw dw-user1"></i> Profile</a
							>
							<a class="dropdown-item" onclick="logOut()" href="#"
								><i class="dw dw-logout"></i> Log Out</a
							>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="right-sidebar">
			<div class="sidebar-title">
				<h3 class="weight-600 font-16 text-blue">
					Layout Settings
					<span class="btn-block font-weight-400 font-12"
						>User Interface Settings</span
					>
				</h3>
				<div class="close-sidebar" data-toggle="right-sidebar-close">
					<i class="icon-copy ion-close-round"></i>
				</div>
			</div>
			<div class="right-sidebar-body customscroll">
				<div class="right-sidebar-body-content">
					<h4 class="weight-600 font-18 pb-10">Header Background</h4>
					<div class="sidebar-btn-group pb-30 mb-10">
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary header-white active"
							>White</a
						>
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary header-dark"
							>Dark</a
						>
					</div>

					<h4 class="weight-600 font-18 pb-10">Sidebar Background</h4>
					<div class="sidebar-btn-group pb-30 mb-10">
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary sidebar-light"
							>White</a
						>
						<a
							href="javascript:void(0);"
							class="btn btn-outline-primary sidebar-dark active"
							>Dark</a
						>
					</div>

					<div class="reset-options pt-30 text-center">
						<button class="btn btn-danger" id="reset-settings">
							Reset Settings
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="left-side-bar">
			<div class="brand-logo" style="display: flex;">
				<div class="logo" style="margin: auto;">LTM</div>
				<div class="close-sidebar" data-toggle="left-sidebar-close">
					<i class="ion-close-round"></i>
				</div>
			</div>
			<div class="menu-block customscroll">
				<div class="sidebar-menu">
					<ul id="accordion-menu">
						<li class="dropdown">
						  <a href="../../pages/roboModel/roboModel.html" class="dropdown-toggle no-arrow">
							<span class="micon bi bi-house"></span
							><span class="mtext">My Model</span>
						  </a>
						</li>
						<li>
						  <a href="#" class="dropdown-toggle no-arrow">
							<span class="micon bi bi-person"></span>
							<span class="mtext">Profile</span>
						  </a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<div class="mobile-menu-overlay"></div>

		<div class="main-container">
			<div class="pd-ltr-20 xs-pd-20-10">
				<div class="min-height-200px">
					<div class="page-header">
						<div class="row">
							<div class="col-md-12 col-sm-12">
								<div class="title">
									<h4>Edit Model</h4>
								</div>
							</div>
						</div>
					</div>
                    <div class="pd-20 card-box mb-30">

						<form id="formEditModel" class="needs-validation" novalidate>
                            <input name="modelID" type="text" class="model_edit-modelID" hidden>
							<div class="form-group row">
								<label class="col-sm-12 col-md-2 col-form-label">Name model</label>
								<div class="col-sm-12 col-md-10">
									<input
                                        name="name"
										class="form-control model_edit-name"
										type="text"
										placeholder="Model xxx"
                                        required
									/>
                                    <div class="invalid-feedback">
                                        Please enter value
                                    </div>
								</div>
                               
							</div>
							<div class="form-group row">
								<label class="col-sm-12 col-md-2 col-form-label">Type Name</label>
								<div class="col-sm-12 col-md-10">
									<input
                                        name="typeName"
										class="form-control model_edit-typename"
										placeholder="Model Type"
										type="text"
										required
                                        
									/>
                                    <div class="invalid-feedback">
                                        Please enter value
                                    </div>
								</div>
							</div>
                            <div class="form-group row">
								<label class="col-sm-12 col-md-2 col-form-label">Image</label>
								<div class="col-sm-12 col-md-10 border">
									<img  class="model_edit-image" src="../../img/image-not-found.png"/>
								</div>
							</div>
                            <div class="form-group row">
								<label class="col-sm-12 col-md-2 col-form-label">Upload new image</label>
								<div class="dropzone" action="#" id="my-awesome-dropzone">
                                    <div class="fallback">
                                        <input type="file" name="file"  required/>
                                    </div>
                                </div>
                                <div class="invalid-feedback invalid-file" >
                                    Please upload a image
                                </div>
							</div>
                            <button type="button" class="btn btn-primary mt-2" id="model_btn-update" >Update</button>
                        </form>				    
					</div>
				</div>
			</div>
		</div>
		<!-- js -->
		<script src="../../vendors/scripts/core.js"></script>
		<script src="../../vendors/scripts/script.min.js"></script>
		<script src="../../vendors/scripts/process.js"></script>
		<script src="../../vendors/scripts/layout-settings.js"></script>
		<script src="../../vendors/scripts/dropzone.js"></script>
        <script type="module" src="./model-edit.js"></script>
		<script type="text/javascript">

            var URL_SERVER_LOCAL  = "https://api.tipslife.site"
            var accessToken = localStorage.getItem("accessToken");

            Dropzone.autoDiscover = false;
            Dropzone.autoProcessQueue = false;

			$(".dropzone").dropzone({
                acceptedFiles: 'image/*',
                maxFiles: 1,
				addRemoveLinks: true,
                autoProcessQueue:false,
				removedfile: function (file) {
					var name = file.name;
					var _ref;
					return (_ref = file.previewElement) != null
						? _ref.parentNode.removeChild(file.previewElement)
						: void 0;
				},
                init: function () {
                    this.on("maxfilesexceeded", function(file){
                        alert("No more files please!");
                    });

                    var submitButton = $("#model_btn-update");
                    var form = $("#formEditModel");

                    myDropzone = this;
                    submitButton.click( function () {

                        var formData = new FormData();
                        //If update file
                        if (myDropzone.files.length >= 1) { 
                            myDropzone.processQueue();         
                            
                            var fileFromDropzone = myDropzone.files[0];

                            // Create a Blob from the file's data
                            var blob = new Blob([fileFromDropzone], { type: fileFromDropzone.type });

                            // Create a new File object from the Blob
                            var convertedFile = new File([blob], fileFromDropzone.name, { type: fileFromDropzone.type });

                            // Append the converted File object to the FormData
                            formData.append('File', fileFromDropzone);

                           
                        }

                        if(!form[0].checkValidity()) {
                            form[0].classList.add('was-validated')
                        }
                        else {

                            var modelID = $('input[name="modelID"]').val();
                            var name = $('input[name="name"]').val();
                            var typeName = $('input[name="typeName"]').val();

                            formData.append("ModelID",modelID);
                            formData.append("Name",name);
                            formData.append("TypeName",typeName);

                            UpdateModel(formData);
                            
                        }  
                        
                    });
                },
                accept: function(file, done) { 
                }
			});
         
			var infoUser = localStorage.getItem('infoUser');
			if(infoUser != null){		
                var user =  JSON.parse(infoUser);
				$(".user-name").text(user.userName);
            }
			
			function logOut(){
				localStorage.removeItem('accessToken');
				localStorage.removeItem('infoUser');
				localStorage.setItem('isLogged',0);
				window.location.href = '../../index.html';
			}

            //Update model
            function UpdateModel(formData){
                $.ajax({
                        url: URL_SERVER_LOCAL + "/api/RoboModel/Update",
                        method: "PUT",
                        headers: { "Authorization": "Bearer " + accessToken },
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function(data){
                            console.log(data);
                            if(data == 1){
                                alert('Update successfully');
                                window.location.reload(history.back());
                                
                            }
                        },
                        error: function(jqXHR, textStatus, errorThrown){
                            console.log(errorThrown );
                        }
                    });
            }

		</script>
	</body>
</html>
