<!DOCTYPE html>
<html>
	<head>
		<!-- Basic Page Info -->
		<meta charset="utf-8" />
		<title>Tieu Luan Lap Trinh Mang</title>
		<link rel="icon" type="image/x-icon" href="../../img/favicon.ico">
		<!-- Site favicon -->
		<link
			rel="apple-touch-icon"
			sizes="180x180"
			href="../../vendors/images/apple-touch-icon.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="32x32"
			href="../../vendors/images/favicon-32x32.png"
		/>
		<link
			rel="icon"
			type="image/png"
			sizes="16x16"
			href="../../vendors/images/favicon-16x16.png"
		/>

		<!-- Mobile Specific Metas -->
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=1"
		/>

		<!-- Google Font -->
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
			rel="stylesheet"
		/>
		<!-- CSS -->
		<link rel="stylesheet" type="text/css" href="../../vendors/styles/core.css" />
		<link
			rel="stylesheet"
			type="text/css"
			href="../../vendors/styles/icon-font.min.css"
		/>
		<link rel="stylesheet" type="text/css" href="../../vendors/styles/style.css" />
        <link rel="stylesheet" type="text/css" href="../../vendors/styles/dropzone.css" />
		  <!-- switchery css -->
		<link
		  rel="stylesheet"
		  type="text/css"
		  href="../../vendors/styles/switchery.min.css"
		  />
	</head>
	<body>
		<div class="pre-loader">
			<div class="pre-loader-box">
				<div class="loader-logo">
					<img src="../../vendors/images/deskapp-logo.svg" alt="" />
				</div>
				<div class="loader-progress" id="progress_div">
					<div class="bar" id="bar1"></div>
				</div>
				<div class="percent" id="percent1">0%</div>
				<div class="loading-text">Loading...</div>
			</div>
		</div>

		<div class="header">
			<div class="header-left">
				<div class="menu-icon bi bi-list"></div>
				<div
					class="search-toggle-icon bi bi-search"
					data-toggle="header_search"
				></div>
			</div>
			<div class="header-right">
				<div class="dashboard-setting user-notification">
					<span class="menu_lang translate" data-translation-key="menu_language"></span>
					<select id="selectLang" class="form-select-lg ml10">
					  <option selected value="1" class="translate" data-translation-key="menu_en">English</option>
					  <option value="2" class="translate" data-translation-key="menu_vn">Vietnamese</option>
					</select>
				  </div>
				<div class="dashboard-setting user-notification">
					<div class="dropdown">
						<input
						type="checkbox"
						class="switch-btn"
						id="chk_lightDark"
					  />
					</div>
				</div>
				<div class="user-info-dropdown">
					<div class="dropdown">
						<a
							class="dropdown-toggle"
							href="#"
							role="button"
							data-toggle="dropdown"
						>
							<span class="user-icon">
								<img src="../../vendors/images/photo1.jpg" alt="" />
							</span>
							<span class="user-name">Ross C. Lopez</span>
						</a>
						<div
							class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list"
						>
							<a class="dropdown-item" href="../users/profile.html"
								><i class="dw dw-user1"></i> <span
								class="mtext translate"
								data-translation-key="menu_profile"
								>Profile</span
								></a
							>
							<a class="dropdown-item" onclick="logOut()" href="#"
								><i class="dw dw-logout"></i> <span
								class="mtext translate"
								data-translation-key="menu_logout"
								>Log out</span
								></a
							>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="left-side-bar">
			<div class="brand-logo" style="display: flex;">
				<div class="logo" style="margin: auto;">LTM</div>
				<div class="close-sidebar" data-toggle="left-sidebar-close">
					<i class="ion-close-round"></i>
				</div>
			</div>
			<div class="menu-block customscroll">
				<div class="sidebar-menu">
					<ul id="accordion-menu">
						<li class="dropdown">
						  <a href="../../pages/roboModel/roboModel.html" class="dropdown-toggle no-arrow">
							<span class="micon bi bi-house"></span
							><span
							class="mtext translate"
							data-translation-key="menu_my_model"
							>My Model</span
						  >
						  </a>
						</li>
						<li>
						  <a href="../users/profile.html" class="dropdown-toggle no-arrow">
							<span class="micon bi bi-person"></span>
							<span
							class="mtext translate"
							data-translation-key="menu_profile"
							>Profile</span
							>
						  </a>
						</li>
					  </ul>
				</div>
			</div>
		</div>
		<div class="mobile-menu-overlay"></div>

		<div class="main-container">
			<div class="pd-ltr-20 xs-pd-20-10">
				<div class="min-height-200px">
					<div class="page-header">
						<div class="row">
							<div class="col-md-12 col-sm-12">
								<div class="title">
									<h4 class="translate"data-translation-key="my_model_create_model">Create new model</h4>
								</div>
							</div>
						</div>
					</div>
                    <div class="pd-20 card-box mb-30">

						<form id="formCreateModel" class="needs-validation" novalidate>
							<div class="form-group row">
								<label class="col-sm-12 col-md-2 col-form-labelt translate" data-translation-key="my_model_name">Name model</label>
								<div class="col-sm-12 col-md-10">
									<input
                                        name="name"
										class="form-control"
										type="text"
										placeholder="Model xxx"
                                        required
									/>
                                    <div class="invalid-feedback translate" data-translation-key="my_model_required">
                                        Please enter value
                                    </div>
								</div>
                               
							</div>
							<div class="form-group row">
								<label class="col-sm-12 col-md-2 col-form-label translate" data-translation-key="my_model_type">Type Name</label>
								<div class="col-sm-12 col-md-10">
									<input
                                        name="typeName"
										class="form-control"
										placeholder="Model Type"
										type="text"
                                        required
									/>
                                    <div class="invalid-feedback translate" data-translation-key="my_model_required">
                                        Please enter value
                                    </div>
								</div>
							</div>
                            <div class="form-group row">
								<label class="col-sm-12 col-md-2 col-form-label translate" data-translation-key="my_model_img">Image</label>
								<div class="dropzone" action="#" id="my-awesome-dropzone">
                                    <div class="fallback">
                                        <input type="file" name="file" required/>
                                    </div>
                                </div>
                                <div class="invalid-feedback invalid-file translate" data-translation-key="my_model_required_img" >
                                    Please upload a image
                                </div>
							</div>
                            <button type="button" class="btn btn-primary mt-2 translate" data-translation-key="my_model_save" id="model_btn-create" >Save</button>
                        </form>				    
					</div>
				</div>
			</div>
		</div>
		<!-- js -->
		<script src="../../vendors/scripts/core.js"></script>
		<script src="../../vendors/scripts/script.min.js"></script>
		<script src="../../vendors/scripts/process.js"></script>
		<!-- switchery js -->
		<script src="../../vendors/scripts/switchery.min.js"></script>
		<script src="../../vendors/scripts/layout-settings.js"></script>
		<script src="../../vendors/scripts/dropzone.js"></script>

        <link rel="stylesheet" href="https://code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css" />
		<script type="text/javascript">

            var URL_SERVER_LOCAL  = "https://api.tipslife.site"
            var accessToken = localStorage.getItem("accessToken");

            Dropzone.autoDiscover = false;
            Dropzone.autoProcessQueue = false;

			$(".dropzone").dropzone({
                acceptedFiles: 'image/*',
                maxFiles: 1,
				addRemoveLinks: true,
                autoProcessQueue:false,
				removedfile: function (file) {
					var name = file.name;
					var _ref;
                    $(".invalid-file").show();
					return (_ref = file.previewElement) != null
						? _ref.parentNode.removeChild(file.previewElement)
						: void 0;
				},
                init: function () {
                    this.on("maxfilesexceeded", function(file){
                        alert("No more files please!");
                    });

                    var submitButton = $("#model_btn-create");
                    var form = $("#formCreateModel");

                    myDropzone = this;
                    submitButton.click( function () {

                        if (myDropzone.files.length >= 1) { 
                            myDropzone.processQueue();         
                            
                            var fileFromDropzone = myDropzone.files[0];

                            // Create a Blob from the file's data
                            var blob = new Blob([fileFromDropzone], { type: fileFromDropzone.type });

                            // Create a new File object from the Blob
                            var convertedFile = new File([blob], fileFromDropzone.name, { type: fileFromDropzone.type });

                            // Create a FormData object
                            var formData = new FormData();

                            // Append the converted File object to the FormData
                            formData.append('File', fileFromDropzone);

                            if(!form[0].checkValidity()) {
                                form[0].classList.add('was-validated')
                            }
                            else {
                                var name = $('input[name="name"]').val();
                                var typeName = $('input[name="typeName"]').val();

                                formData.append("Name",name);
                                formData.append("TypeName",typeName);

                                $.ajax({
                                    url: URL_SERVER_LOCAL + "/api/RoboModel/AddModel",
                                    method: "POST",
                                    headers: { "Authorization": "Bearer " + accessToken },
                                    data: formData,
                                    processData: false,
                                    contentType: false,
                                    success: function(data){
                                        if(data == 1){
                                            alert('Added successfully');
                                            window.location.href = "../../pages/roboModel/roboModel.html";
                                           
                                        }
                                    },
                                    error: function(jqXHR, textStatus, errorThrown){
                                        console.log(errorThrown );
                                    }
                                });

                            }  
                        }
                        else {
                            $(".invalid-file").show();
                        }
                    });
                },
                accept: function(file, done) { 
                   $(".invalid-file").hide();
                }
			});
         
			var infoUser = localStorage.getItem('infoUser');
			if(infoUser != null){		
                var user =  JSON.parse(infoUser);
				$(".user-name").text(user.userName);
            }
			
			function logOut(){
				localStorage.removeItem('accessToken');
				localStorage.removeItem('infoUser');
				localStorage.setItem('isLogged',0);
				window.location.href = '../../index.html';
			}
		</script>
	</body>
</html>
